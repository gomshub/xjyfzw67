
You can use cURL to delete a Docker image or Helm chart from Artifactory using the Artifactory REST API.

â¸»

1. Delete Docker Image from Artifactory

Use the Artifactory API to delete an image from the Docker registry.

Command:

curl -u <username>:<api-token> -X DELETE "https://artifactory-test.example.com/artifactory/my-docker-repo/my-app/1.0.0"

Example:

curl -u myuser:AKCp8hJr9ex...myAPItoken -X DELETE "https://artifactory-test.example.com/artifactory/docker-local/my-app/1.0.0"

âœ… This deletes the entire image tag (1.0.0) from the repository.
âœ… If you want to delete all versions of an image, use a loop or DELETE /my-app.

â¸»

2. Delete Helm Chart from Artifactory

Helm charts are stored as .tgz files in Artifactory. To delete a Helm chart version:

Command:

curl -u <username>:<api-token> -X DELETE "https://artifactory-test.example.com/artifactory/helm-repo/my-helm-chart-1.0.0.tgz"

Example:

curl -u myuser:AKCp8hJr9ex...myAPItoken -X DELETE "https://artifactory-test.example.com/artifactory/helm-local/my-helm-chart-1.0.0.tgz"

âœ… This removes the Helm chart package (.tgz) from Artifactory.

â¸»

3. Verify Deletion

After deletion, check if the artifact is gone:

For Docker Image:

curl -u <username>:<api-token> -X GET "https://artifactory-test.example.com/artifactory/my-docker-repo/my-app/"

If the version is deleted, you wonâ€™t see it in the response.

For Helm Chart:

helm repo update
helm search repo my-helm-chart

If the chart is deleted, it wonâ€™t appear in search results.

â¸»

Summary

Action	Command
Delete Docker Image	curl -u <user>:<token> -X DELETE "https://artifactory-test/artifactory/docker-local/my-app/1.0.0"
Delete Helm Chart	curl -u <user>:<token> -X DELETE "https://artifactory-test/artifactory/helm-local/my-chart-1.0.0.tgz"
Verify Docker Deletion	curl -u <user>:<token> -X GET "https://artifactory-test/artifactory/docker-local/my-app/"
Verify Helm Deletion	helm repo update && helm search repo my-helm-chart

Let me know if you need more details! ðŸš€


I see the exact issue now. Youâ€™re dealing with two conflicting requirements in ArgoCD:
	1.	Helm chart packaging includes a values.yaml, but you want ArgoCD to use its own values.yaml when deploying. However, by default, ArgoCD is still referring to the packaged values.yaml.
	2.	You need to override only the Docker image version dynamically, without modifying values.yaml manually or in Git every time.

â¸»

Solution: Use ArgoCDâ€™s valueFiles + helm.parameters Together

ArgoCD does not automatically override the packaged values.yaml.
	â€¢	âœ… To force ArgoCD to use its own values.yaml, you must specify valueFiles.
	â€¢	âœ… To dynamically override the image version, you should use helm.parameters.

â¸»

How to Fix This?

Modify your ArgoCD Application YAML like this:

apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: my-app
spec:
  destination:
    server: https://kubernetes.default.svc
    namespace: my-namespace
  source:
    repoURL: "https://my-artifactory-url"
    chart: test-charts
    targetRevision: 1.0.0
    helm:
      valueFiles:
        - values.yaml  # Force ArgoCD to use its own values.yaml
      parameters:
        - name: "image.tag"
          value: "1.0"  # This will override whatever is in values.yaml

Explanation:
	1.	valueFiles: ["values.yaml"] â†’ Ensures ArgoCD is not using the Helm-packaged values.yaml from Artifactory.
	2.	parameters: [{"name": "image.tag", "value": "1.0"}] â†’ Dynamically overrides just the image version at runtime.

â¸»

Updating the Docker Image Version via API

Now, when you want to update the image version dynamically, you can just update the Helm parameter using a curl request:

APP_NAME="my-app"
ARGOCD_SERVER="your-argocd-server.com"
NEW_IMAGE_VERSION="1.1"

TOKEN=$(curl -k -X POST "https://$ARGOCD_SERVER/api/v1/session" \
  -d '{"username":"your-username","password":"your-password"}' \
  -H "Content-Type: application/json" | jq -r .token)

curl -k -X PATCH "https://$ARGOCD_SERVER/api/v1/applications/$APP_NAME" \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "spec": {
      "source": {
        "helm": {
          "parameters": [
            {
              "name": "image.tag",
              "value": "'"$NEW_IMAGE_VERSION"'"
            }
          ]
        }
      }
    }
  }'



â¸»

Summary

âœ… Ensuring ArgoCD uses its own values.yaml â†’ Set valueFiles: ["values.yaml"]
âœ… Allowing dynamic Docker image version updates â†’ Use helm.parameters
âœ… Updating image version without modifying values.yaml â†’ Use ArgoCD API

This setup ensures that:
	â€¢	ArgoCD ignores the values.yaml from the Helm package in Artifactory.
	â€¢	ArgoCD uses its own values.yaml.
	â€¢	You can still dynamically update the Docker image version via API without modifying files.

This should completely solve your problem! Let me know if you need more details.