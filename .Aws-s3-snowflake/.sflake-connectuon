Here is the single, complete checklist you can follow end-to-end to fix Snowflake PrivateLink timeouts from Lambda in VPC.
If any one item is missing, the connection will hang.

â¸»

âœ… Snowflake PrivateLink from Lambda â€” CHECK & FIX LIST

1ï¸âƒ£ Snowflake account URL (MOST COMMON ISSUE)

âœ… MUST use Snowflake PrivateLink URL

<account>.<region>.privatelink.snowflakecomputing.com

âŒ DO NOT use
	â€¢	vpce-xxxx
	â€¢	account.region.snowflakecomputing.com

ğŸ“Œ Fix: Update account= in code/config

â¸»

2ï¸âƒ£ Snowflake Interface VPC Endpoint exists

AWS Console â†’ VPC â†’ Endpoints

âœ… Must exist
	â€¢	Type: Interface
	â€¢	Service name: vpce-svc-xxxxxxxx (Snowflake provided)
	â€¢	VPC: same as Lambda
	â€¢	Subnets: same as Lambda

ğŸ“Œ Fix: Create endpoint in Lambda VPC/subnets

â¸»

3ï¸âƒ£ Private DNS is ENABLED on endpoint (CRITICAL)

Endpoint â†’ Edit

Private DNS: ENABLED âœ…

ğŸ“Œ Fix: Enable Private DNS and save

â¸»

4ï¸âƒ£ Security Groups (MOST MISSED)

a) Lambda Security Group

Outbound rules

TCP 443 â†’ 0.0.0.0/0

(or Snowflake endpoint SG)

b) Snowflake Endpoint Security Group

Inbound rules

TCP 443 â†’ Lambda Security Group

ğŸ“Œ Fix: Add missing inbound/outbound rules

â¸»

5ï¸âƒ£ Lambda subnet routing

âœ… Lambda must be in private subnets

Route table must include:

local VPC route (automatic)

âŒ No NAT required for PrivateLink

ğŸ“Œ Fix: Ensure Lambda subnets are correct

â¸»

6ï¸âƒ£ DNS resolution test (INSIDE Lambda)

Add temporarily:

import socket
print(socket.gethostbyname(
    "<account>.<region>.privatelink.snowflakecomputing.com"
))

âœ… If IP returned â†’ DNS OK

âŒ If timeout â†’ endpoint or Private DNS broken

ğŸ“Œ Fix: Recheck steps 2 & 3

â¸»

7ï¸âƒ£ Snowflake connector code (correct)

snowflake.connector.connect(
    user=USER,
    account="<account>.<region>.privatelink",
    private_key=PRIVATE_KEY,
    protocol="https",
    port=443,
    login_timeout=10,
    network_timeout=10
)

ğŸ“Œ Fix: Ensure protocol, port, and timeouts are set

â¸»

8ï¸âƒ£ SSH private key formatting (NOT the root cause, but must be correct)

Stored as 1 line with \\n:

-----BEGIN PRIVATE KEY-----\\nMIIEv...\\n-----END PRIVATE KEY-----

In code:

private_key = key_str.replace("\\n", "\n")

ğŸ“Œ Fix: Replace \\n â†’ \n before loading key

â¸»

9ï¸âƒ£ S3 access (since no Secrets Manager endpoint)

âœ… Must exist
	â€¢	S3 Gateway VPC Endpoint
	â€¢	IAM role allows s3:GetObject

ğŸ“Œ Fix: Add endpoint or IAM permission if missing

â¸»

1ï¸âƒ£0ï¸âƒ£ Optional but HIGHLY recommended endpoints

Create these to avoid future timeouts:

Service	Endpoint
CloudWatch Logs	Interface
STS	Interface
KMS	Interface


â¸»

ğŸ§  FINAL TRUTH (remember this)

If DNS + Endpoint + SG are correct, Snowflake NEVER times out.
Timeout = network path missing, not code.

â¸»

âœ… Minimal working architecture

Lambda (VPC)
 â”œâ”€ S3 Gateway Endpoint
 â”œâ”€ Snowflake Interface Endpoint (PrivateLink)
 â”œâ”€ Private DNS ENABLED
 â”œâ”€ SG allows TCP 443
 â””â”€ Snowflake privatelink URL in code


â¸»

If you want next, I can:
	â€¢	Validate your setup step-by-step
	â€¢	Provide Terraform for all endpoints
	â€¢	Give VPC Flow Log queries to pinpoint failures
	â€¢	Create a one-click connectivity test Lambda

Just say ğŸ‘