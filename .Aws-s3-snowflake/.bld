Got it â€” you want a GitHub Actions workflow that builds your ENTIRE Lambda package (your app + all Python dependencies) inside a Docker container, then zips it, uploads it as an artifact, and you will manually upload the ZIP to S3 and attach to Lambda.

Here is the cleanest working workflow for Windows-compatible builds (because Docker builds inside Linux container, so Lambda-native).
No Lambda Layers â€” everything bundled in a single ZIP.

â¸»

âœ… GitHub Workflow: Build Full Lambda App With Docker & Zip

âœ” Builds inside a Linux Docker container â†’ Dependencies 100% Lambda compatible

âœ” Produces a single ZIP file containing:
	â€¢	Your app.py or Lambda handler
	â€¢	Linux-compiled Python dependencies (cffi, cryptography, etc.)
	â€¢	Any local packages
	â€¢	Any compiled libraries

â¸»

ğŸ“„ .github/workflows/build-lambda.yml

name: Build Lambda Package in Docker

on:
  push:
    branches: ["main"]
  workflow_dispatch:

jobs:
  build-lambda:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Build Docker image
      run: |
        docker build -t lambda-builder -f Dockerfile.lambda .

    - name: Create build output directory
      run: mkdir -p build_output

    - name: Run builder container to generate zip
      run: |
        docker run --rm \
          -v ${{ github.workspace }}/build_output:/output \
          lambda-builder

    - name: Upload ZIP as workflow artifact
      uses: actions/upload-artifact@v4
      with:
        name: lambda-package
        path: build_output/lambda_package.zip


â¸»

ğŸ“¦ Dockerfile for Building Full Lambda Package

Save as Dockerfile.lambda in your repo.

FROM public.ecr.aws/lambda/python:3.9  AS builder

# Install zip, gcc, and build tools
RUN yum install -y zip gcc gcc-c++ make openssl-devel libffi-devel

# Create working directory
WORKDIR /build

# Copy project
COPY . .

# Install all python deps into /build/python (Lambda layout)
RUN pip install -r requirements.txt -t .

# Remove unnecessary files to reduce package size
RUN find . -type d -name "__pycache__" -exec rm -r {} +
RUN find . -type d -name "*.dist-info" -exec rm -r {} +

# ZIP final package
RUN zip -r9 /tmp/lambda_package.zip .

# Final image to just export the ZIP
FROM public.ecr.aws/amazonlinux/amazonlinux:2

COPY --from=builder /tmp/lambda_package.zip /output/lambda_package.zip

CMD cp /output/lambda_package.zip /output/lambda_package.zip


â¸»

ğŸ“¤ How this works

1ï¸âƒ£ GitHub Actions builds the Docker image

This creates a fully Linux-compatible Python build.

2ï¸âƒ£ Container runs and produces â†’ lambda_package.zip

ZIP is placed inside /build_output on GitHub runner.

3ï¸âƒ£ ZIP is uploaded as a workflow artifact

You download it from GitHub Actions â†’ upload to S3 â†’ attach to Lambda.

â¸»

ğŸ§ª Testing tip (IMPORTANT for cryptography/cffi)

Your Lambda runtime must match the build runtime:
	â€¢	Build used: public.ecr.aws/lambda/python:3.9
	â€¢	Lambda runtime must be: Python 3.9

If youâ€™re using Python 3.12 or 3.11 at Lambda â†’ change the base image:

FROM public.ecr.aws/lambda/python:3.12


â¸»

â— If you still get errors like cffi, cryptography, libffi.so.6

Then add:

yum install -y libffi libffi-devel openssl-devel

â€¦already included above.

â¸»

ğŸ‘ If you want:

I can generate:

âœ… GitHub Action that also uploads to S3 automatically
âœ… GitHub Action that also updates the Lambda function automatically
âœ… Multi-arch builds (AMD64/ARM64) for Graviton Lambdas
âœ… Versioning + tagging + separate dev/prod builds

Just tell me!