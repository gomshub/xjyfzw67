
aws s3api list-objects-v2 \
  --bucket your-bucket-name \
  --query "Contents[].{Key:Key,Size:Size,LastModified:LastModified}" \
  --output text > objects.csv



import boto3
import os

s3 = boto3.resource("s3")

def lambda_handler(event, context):
    bucket_name = os.environ.get("BUCKET")
    if not bucket_name:
        return {"status": "error", "message": "BUCKET env variable missing"}

    bucket = s3.Bucket(bucket_name)

    try:
        # Delete all versions (if bucket is versioned)
        if bucket.versioning().status == 'Enabled':
            bucket.object_versions.delete()

        # Delete all objects (for non-versioned or remaining objects)
        bucket.objects.all().delete()

        return {
            "status": "success",
            "message": f"Bucket {bucket_name} emptied successfully"
        }

    except Exception as e:
        return {"status": "error", "message": str(e)}