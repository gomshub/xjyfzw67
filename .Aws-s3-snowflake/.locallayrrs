Perfect — since you’re switching to Lambda layers, we can design a complete Linux-compatible workflow:
	•	Dockerfiles for each layer (e.g., Snowflake, Cryptography, PyYAML)
	•	Build in GitHub Actions → push layer ZIPs to Artifactory
	•	Download ZIPs from Artifactory → attach to Lambda
	•	Fully compatible with Linux Lambda runtime

I’ll give you ready-to-use Dockerfiles, build commands, and upload instructions.

⸻

1️⃣ Dockerfiles for Lambda Layers (Python 3.12 / Amazon Linux 2023)

A. Snowflake Layer (Dockerfile.snowflake)

FROM public.ecr.aws/lambda/python:3.12

# Install required system libs
RUN dnf install -y gcc libffi-devel python3-devel openssl-devel zip && dnf clean all

# Disable optional heavy dependencies
ENV SF_INSTALL_OPTIONAL_DEPENDENCIES=0

# Create layer folder
RUN mkdir -p /opt/python

# Install minimal Snowflake connector
RUN pip install --no-cache-dir snowflake-connector-python==3.10.1 -t /opt/python

# Clean unnecessary files
RUN find /opt/python -name "__pycache__" -type d -exec rm -rf {} + \
    && find /opt/python -name "*.dist-info" -type d -exec rm -rf {} + \
    && find /opt/python -name "tests" -type d -exec rm -rf {} +

# Zip the layer
RUN cd /opt && zip -r9 /snowflake-layer.zip python


⸻

B. Cryptography Layer (Dockerfile.cryptography)

FROM public.ecr.aws/lambda/python:3.12

# Install system dependencies
RUN dnf install -y gcc libffi-devel python3-devel openssl-devel zip && dnf clean all

# Layer folder
RUN mkdir -p /opt/python

# Install cryptography
RUN pip install --no-cache-dir cryptography -t /opt/python

# Remove caches / pycache
RUN find /opt/python -name "__pycache__" -type d -exec rm -rf {} + \
    && find /opt/python -name "*.dist-info" -type d -exec rm -rf {} + \
    && find /opt/python -name "tests" -type d -exec rm -rf {} +

# Zip
RUN cd /opt && zip -r9 /cryptography-layer.zip python


⸻

C. PyYAML Layer (Dockerfile.pyyaml)

FROM public.ecr.aws/lambda/python:3.12

# Install system dependencies
RUN dnf install -y gcc python3-devel zip && dnf clean all

RUN mkdir -p /opt/python

# Install PyYAML
RUN pip install --no-cache-dir PyYAML -t /opt/python

# Remove unnecessary files
RUN find /opt/python -name "__pycache__" -type d -exec rm -rf {} + \
    && find /opt/python -name "*.dist-info" -type d -exec rm -rf {} + \
    && find /opt/python -name "tests" -type d -exec rm -rf {} +

# Zip
RUN cd /opt && zip -r9 /pyyaml-layer.zip python


⸻

2️⃣ Build & extract ZIPs (Linux compatible)

For Snowflake layer:

docker build -f Dockerfile.snowflake -t snowflake-layer .
docker run --name snowflake_build snowflake-layer
docker cp snowflake_build:/snowflake-layer.zip ./snowflake-layer.zip
docker rm snowflake_build

Repeat for cryptography-layer.zip and pyyaml-layer.zip.

These ZIPs are fully Lambda compatible (top-level python/ folder, Python 3.12, Amazon Linux 2023).

⸻

3️⃣ Upload ZIPs to Artifactory (example CLI)

curl -u $ARTIFACTORY_USER:$ARTIFACTORY_API_KEY -T snowflake-layer.zip \
    "https://myartifactory.example/artifactory/lambda-layers/snowflake-layer.zip"

curl -u $ARTIFACTORY_USER:$ARTIFACTORY_API_KEY -T cryptography-layer.zip \
    "https://myartifactory.example/artifactory/lambda-layers/cryptography-layer.zip"

curl -u $ARTIFACTORY_USER:$ARTIFACTORY_API_KEY -T pyyaml-layer.zip \
    "https://myartifactory.example/artifactory/lambda-layers/pyyaml-layer.zip"

You can automate this in GitHub Actions with curl or jfrog rt upload.

⸻

4️⃣ Download from Artifactory for Lambda Console
	1.	Download the ZIP:

curl -u $ARTIFACTORY_USER:$ARTIFACTORY_API_KEY -O \
    "https://myartifactory.example/artifactory/lambda-layers/snowflake-layer.zip"

	2.	Go to AWS Console → Lambda → Layers → Create layer
	•	Upload the ZIP
	•	Runtime: Python 3.12
	3.	Repeat for cryptography and pyyaml.

⸻

5️⃣ Attach layers to Lambda function
	•	Lambda → Configuration → Layers → Add layer → Custom layers
	•	Select the layers in order:
	1.	Snowflake
	2.	Cryptography
	3.	PyYAML
	•	Set environment variables for Snowflake, S3, etc. as needed.

⸻

✅ 6️⃣ GitHub Actions Example Workflow (Simplified)

name: Build Lambda Layers
on: [push]

jobs:
  build_layers:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Build Snowflake Layer
        run: |
          docker build -f Dockerfile.snowflake -t snowflake-layer .
          docker run --name snowflake_build snowflake-layer
          docker cp snowflake_build:/snowflake-layer.zip ./snowflake-layer.zip
          docker rm snowflake_build

      - name: Upload to Artifactory
        run: |
          curl -u $ARTIFACTORY_USER:$ARTIFACTORY_API_KEY -T snowflake-layer.zip \
            "https://myartifactory.example/artifactory/lambda-layers/snowflake-layer.zip"

Repeat steps for cryptography and pyyaml layers.

⸻

✅ Summary
	•	Dockerfiles build Lambda-compatible ZIPs for Python 3.12 / Amazon Linux 2023.
	•	GitHub workflow builds → pushes ZIPs to Artifactory.
	•	Download ZIPs → upload to Lambda Layers via AWS Console.
	•	Attach layers to Lambda function → ready to use Snowflake, Cryptography, PyYAML, etc.

⸻

If you want, I can provide a combined Dockerfile that produces one single ZIP with all three packages for simpler Lambda attachment.

Do you want me to do that?

Yes — you can build Lambda layers from a Windows machine using Docker, without needing GitHub Actions. The workflow is almost identical; the only difference is paths and commands for Windows.

Here’s the step-by-step guide:

⸻

1️⃣ Prepare folders on Windows

For example, create a folder:

C:\lambda-layers

Inside it, you can put your Dockerfiles:

C:\lambda-layers\Dockerfile.snowflake
C:\lambda-layers\Dockerfile.cryptography
C:\lambda-layers\Dockerfile.pyyaml


⸻

2️⃣ Use the same Dockerfiles (Linux inside Docker)

The Dockerfiles from my previous message work on Windows because Docker uses a Linux container (Amazon Linux 2023) to build the ZIPs.

No changes are needed to the Dockerfile itself. Example: Dockerfile.snowflake.

⸻

3️⃣ Build & extract ZIPs on Windows

Open PowerShell or CMD:

Snowflake layer

cd C:\lambda-layers

# Build Docker image
docker build -f Dockerfile.snowflake -t snowflake-layer .

# Create a container and extract ZIP
docker run --name snowflake_build snowflake-layer
docker cp snowflake_build:/snowflake-layer.zip C:\lambda-layers\snowflake-layer.zip
docker rm snowflake_build

Cryptography layer

docker build -f Dockerfile.cryptography -t cryptography-layer .
docker run --name crypto_build cryptography-layer
docker cp crypto_build:/cryptography-layer.zip C:\lambda-layers\cryptography-layer.zip
docker rm crypto_build

PyYAML layer

docker build -f Dockerfile.pyyaml -t pyyaml-layer .
docker run --name pyyaml_build pyyaml-layer
docker cp pyyaml_build:/pyyaml-layer.zip C:\lambda-layers\pyyaml-layer.zip
docker rm pyyaml_build

At this point, you have all three Lambda-compatible ZIPs on Windows.

⸻

4️⃣ Upload to AWS Lambda Layers via Console
	1.	Go to AWS Console → Lambda → Layers → Create layer
	2.	Upload each ZIP (snowflake-layer.zip, cryptography-layer.zip, pyyaml-layer.zip)
	3.	Select Python 3.12 runtime
	4.	Click Create

⸻

5️⃣ Use the layers in your Lambda function
	•	Lambda → Configuration → Layers → Add layer → select your uploaded layers
	•	Make sure to attach all required layers in correct order

⸻

6️⃣ Optional: Push ZIPs to Artifactory

You can also upload the ZIPs from Windows to Artifactory using curl:

curl -u $ARTIFACTORY_USER:$ARTIFACTORY_API_KEY -T C:\lambda-layers\snowflake-layer.zip "https://myartifactory.example/artifactory/lambda-layers/snowflake-layer.zip"

Repeat for other layers.

⸻

✅ Notes
	•	Docker Desktop on Windows is required. Make sure it’s using Linux containers.
	•	The ZIPs produced inside Docker are fully compatible with Linux Lambda runtime.
	•	You don’t need to install Python or any dependencies on Windows — Docker handles it.

⸻

If you want, I can provide a single Windows PowerShell script that:
	1.	Builds all three layers from Docker
	2.	Extracts the ZIPs
	3.	(Optionally) uploads them to Artifactory

This will fully automate your Windows local workflow.

Do you want me to create that script?