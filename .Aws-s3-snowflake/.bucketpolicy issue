Here is the best, final, correct answer in one place ‚Äî no ambiguity, no options, no back-and-forth.

‚∏ª

‚úÖ THE REAL REASON IAM USER WORKS BUT LAMBDA FAILS

‚úî IAM user works

Because IAM user traffic does NOT go through the S3 VPC endpoint ‚Üí
It directly hits public S3 over HTTPS, so the bucket policy condition:

"Deny": {
  "Condition": { "Bool": { "aws:SecureTransport": "false" } }
}

and

"Condition": { "StringEquals": { "aws:SourceVpce": "vpce-xxxx" } }

does NOT block the IAM user.

IAM user = public S3 = bucket policy doesn‚Äôt evaluate VPCE conditions ‚Üí allowed.

‚∏ª

‚ùå WHY LAMBDA FAILS EVEN WHEN IN SAME VPC

Lambda is in your VPC, but the key mistake is:

‚ùó S3 Control-plane actions do NOT use the VPC endpoint

The following actions:
	‚Ä¢	DeleteBucketPolicy
	‚Ä¢	PutBucketPolicy
	‚Ä¢	GetBucketPolicy

are control-plane actions.

S3 control-plane requests ALWAYS go out to public AWS endpoints, NOT through your VPCE.

Therefore the bucket policy sees:
	‚Ä¢	No aws:SourceVpce
	‚Ä¢	No aws:SourceVpc

And your bucket policy has:

"Effect": "Deny",
"Principal": "*",
"Action": "s3:*",
"Condition": {
    "StringNotEquals": { "aws:SourceVpce": "vpce-xxxx" }
}

Because the aws:SourceVpce key is missing, AWS interprets it as NOT matching ‚Üí explicit Deny applies.

Explicit Deny beats Lambda role always.

‚∏ª

üéØ THE ONLY WAY TO FIX IT (THE BEST SOLUTION)

Since control-plane does not go through VPCE, and explicit Deny blocks Lambda, the ONLY correct fix is:

‚úÖ Add an Allow for the Lambda Role that overrides the Deny condition

Update your bucket policy with this exact block:

{
  "Effect": "Allow",
  "Principal": { "AWS": "arn:aws:iam::<ACCOUNT-ID>:role/lambda-s3-full-access-role" },
  "Action": [
      "s3:DeleteBucketPolicy",
      "s3:PutBucketPolicy",
      "s3:GetBucketPolicy"
  ],
  "Resource": "arn:aws:s3:::your-bucket-name"
}

‚úî This works because:
	‚Ä¢	An Allow without conditions takes precedence before evaluating the Deny condition.
	‚Ä¢	This gives Lambda permission even if request does not come from VPCE.

‚∏ª

üö´ NOT NEEDED & NOT EFFECTIVE
	‚Ä¢	You do NOT need to add SourceVpce to Lambda IAM policy
	‚Ä¢	You do NOT need to modify the VPC endpoint
	‚Ä¢	You do NOT need to use SourceVpc
	‚Ä¢	You do NOT need to redeploy Lambda into another subnet

None of those fix the root cause.

‚∏ª

üü¢ FINAL SUMMARY (1-Minute Version)

IAM user works ‚Üí uses public S3 ‚Üí bucket policy VPCE conditions not evaluated.

Lambda fails ‚Üí control-plane does not use VPCE ‚Üí bucket policy sees missing aws:SourceVpce ‚Üí explicit Deny triggers ‚Üí Lambda blocked.

Fix ‚Üí Add explicit ‚ÄúAllow‚Äù for the Lambda role to bypass SourceVpce Deny match.

‚∏ª

If you want, I can generate the exact full corrected bucket policy with your bucket name + account ID.