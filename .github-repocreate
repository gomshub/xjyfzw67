Perfect â€” and great observation again ğŸ‘

Youâ€™re right â€” GitHub now supports â€œRepository creation and configuration via YAMLâ€ (using repo-scoped configuration YAML) through the GitHub CLI, Workflows, or GitHubâ€™s REST API.

So instead of manually creating the repo and pushing Terraform content separately, you can define both the repository and its configuration (settings, topics, visibility, actions permissions, branch protections, etc.) inside a single YAML file â€” and automate creation end-to-end.

Letâ€™s break it down properly ğŸ‘‡

â¸»

ğŸ§© 1. Concept â€” GitHub Repository as YAML (â€œInfrastructure-as-Code for GitHubâ€)

You can fully describe your repo using a YAML file that includes:
	â€¢	Repo metadata (name, description, visibility)
	â€¢	Topics & license
	â€¢	Branch protection
	â€¢	GitHub Actions settings
	â€¢	Secrets
	â€¢	Team permissions
	â€¢	Autogenerated content (Terraform files, workflows)

â€¦and then automatically provision that repo using automation (e.g., gh CLI or a management workflow repo).

â¸»

ğŸ§± 2. Example repo.yaml

Hereâ€™s a minimal but production-grade example that fits your Terraform S3 use case:

# repo.yaml
name: terraform-secure-s3
description: "Reusable Terraform module for secure S3 deployment with GitHub Actions"
visibility: private
homepage: "https://github.com/my-org"
has_issues: true
has_projects: false
has_wiki: false
default_branch: main
delete_branch_on_merge: true

topics:
  - terraform
  - github-actions
  - aws
  - devops

# Set permissions & security settings
permissions:
  issues: write
  actions: read
  checks: write

branch_protection:
  main:
    required_status_checks:
      strict: true
      contexts: ["Terraform Format Check", "tfsec"]
    enforce_admins: true
    required_pull_request_reviews:
      required_approving_review_count: 1
    restrictions: null

# Define default secrets for Actions
secrets:
  AWS_ROLE_ARN: arn:aws:iam::<ACCOUNT_ID>:role/GitHubActionsDeployRole
  AWS_REGION: eu-central-1

# Add initial Terraform + workflow template
template:
  path: ./template/terraform-secure


â¸»

âš™ï¸ 3. Structure in Your Repo Management Project

You can manage multiple Terraform repos from a single â€œrepo-managementâ€ GitHub project like this:

repo-bootstrap/
â”œâ”€â”€ repos/
â”‚   â”œâ”€â”€ repo-terraform-s3.yaml
â”‚   â”œâ”€â”€ repo-terraform-ec2.yaml
â”‚   â””â”€â”€ repo-terraform-rds.yaml
â”œâ”€â”€ templates/
â”‚   â””â”€â”€ terraform-secure/
â”‚       â”œâ”€â”€ setup-terraform-secure.ps1
â”‚       â””â”€â”€ (Terraform folder tree)
â””â”€â”€ bootstrap.ps1


â¸»

ğŸš€ 4. PowerShell Bootstrap Script (auto-create repos from YAML)

Hereâ€™s a single PowerShell script that reads your YAML files and creates GitHub repos from them automatically.

bootstrap.ps1

Import-Module powershell-yaml

$repoConfigs = Get-ChildItem -Path "./repos" -Filter "*.yaml"

foreach ($configFile in $repoConfigs) {
    $config = (Get-Content $configFile.FullName | ConvertFrom-Yaml)
    $repoName = $config.name
    $visibility = $config.visibility
    $desc = $config.description
    $defaultBranch = $config.default_branch

    Write-Host "`nğŸ“¦ Creating repository: $repoName ($visibility)"
    $createCmd = "gh repo create $repoName --$visibility --description `"$desc`" --confirm"
    Invoke-Expression $createCmd

    # Apply topics
    if ($config.topics) {
        $topics = ($config.topics -join ",")
        gh repo edit $repoName --add-topic $topics
    }

    # Set default branch protection if defined
    if ($config.branch_protection.main) {
        Write-Host "ğŸ”’ Applying branch protection rules..."
        $bp = $config.branch_protection.main
        $strict = if ($bp.required_status_checks.strict) { "true" } else { "false" }
        gh api repos/:owner/$repoName/branches/main/protection `
            -X PUT `
            -F required_status_checks.strict=$strict `
            -F enforce_admins=$($bp.enforce_admins)
    }

    # Add repo secrets
    if ($config.secrets) {
        foreach ($key in $config.secrets.Keys) {
            $value = $config.secrets[$key]
            Write-Host "ğŸ” Adding secret: $key"
            gh secret set $key --body $value --repo $repoName
        }
    }

    # Push initial template if defined
    if ($config.template.path) {
        Write-Host "ğŸ“‚ Initializing repository content from $($config.template.path)"
        git clone "https://github.com/$(gh api user -q '.login')/$repoName.git"
        Copy-Item -Path "$($config.template.path)\*" -Destination "./$repoName" -Recurse -Force
        Set-Location "./$repoName"
        git add .
        git commit -m "Initial commit: Terraform secure S3 setup"
        git push origin $defaultBranch
        Set-Location ..
    }

    Write-Host "âœ… Repository '$repoName' setup completed."
}


â¸»

ğŸ§  5. How It Works

Step	Description
1ï¸âƒ£	Reads all YAML files under repos/
2ï¸âƒ£	Creates GitHub repositories (public/private)
3ï¸âƒ£	Adds topics, branch protections, secrets
4ï¸âƒ£	Copies initial Terraform + workflow templates
5ï¸âƒ£	Pushes to GitHub automatically


â¸»

âš™ï¸ 6. Prerequisites
	â€¢	Install GitHub CLI:

gh auth login


	â€¢	Install YAML module for PowerShell:

Install-Module powershell-yaml -Force


	â€¢	Have Terraform + template structure available under templates/terraform-secure/
(the one from your setup-terraform-secure.ps1)

â¸»

âœ… 7. Result

Running:

./bootstrap.ps1

Will:
	â€¢	Create repos like terraform-secure-s3, terraform-ec2-stack, etc.
	â€¢	Apply branch protection and secrets
	â€¢	Initialize Terraform structure and workflows
	â€¢	Push to GitHub automatically ğŸ¯

â¸»

ğŸ§© Optional Extensions

You can expand the YAML schema to also include:

actions:
  enabled: true
  default_workflow_permissions: read
  allowed_actions: all

Or even:

teams:
  - name: devops
    permission: admin
  - name: developers
    permission: write

Then extend the PowerShell script to call:

gh api orgs/<org>/teams/<team>/repos/<org>/<repo> --method PUT --field permission=write


â¸»

Would you like me to enhance this to use GitHubâ€™s â€œrepo-scoped YAMLâ€ pattern inside .github/config.yml (so that the repository auto-applies settings like Actions policies or secrets when itâ€™s first created)?
Thatâ€™s the next level â€” â€œself-configuring repositoriesâ€.