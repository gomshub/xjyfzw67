**Creating IaC for CloudWatch and DLQ**

The user wants IaC code for both a CloudWatch alarm on Lambda errors and a DLQ with an alarm. Since they didn't specify a preference, I'll go with Terraform. I need to keep it concise but complete, so I'll provide two examples: one for the CloudWatch alarm and one for the DLQ with an alarm. I'll avoid too much explanation, just enough to make it clear. Let’s get started!
Here’s a minimal Terraform example for both patterns, assuming you already have a Lambda.

Replace `my-lambda-func` and ARNs/names as needed.

### 1) CloudWatch alarm on Lambda errors (cheapest)

```hcl
# Lambda (example – if you already have it, skip)
resource "aws_lambda_function" "snowflake_to_s3" {
  function_name = "my-lambda-func"
  role          = aws_iam_role.lambda_exec.arn
  handler       = "app.handler"
  runtime       = "python3.11"
  filename      = "lambda.zip"
}

# CloudWatch alarm on Lambda Errors > 0
resource "aws_cloudwatch_metric_alarm" "lambda_errors_alarm" {
  alarm_name          = "lambda-my-lambda-func-errors"
  comparison_operator = "GreaterThanThreshold"
  evaluation_periods  = 1
  metric_name         = "Errors"
  namespace           = "AWS/Lambda"
  period              = 60
  statistic           = "Sum"
  threshold           = 0

  dimensions = {
    FunctionName = aws_lambda_function.snowflake_to_s3.function_name
  }

  alarm_description = "Alarm when Lambda my-lambda-func has any errors"
  alarm_actions     = [aws_sns_topic.alerts.arn]
}

# SNS topic for alerts
resource "aws_sns_topic" "alerts" {
  name = "lambda-alerts"
}

# Example email subscription
resource "aws_sns_topic_subscription" "alerts_email" {
  topic_arn = aws_sns_topic.alerts.arn
  protocol  = "email"
  endpoint  = "you@example.com"
}
```

---

### 2) DLQ (SQS) + alarm on DLQ messages

```hcl
# SQS DLQ
resource "aws_sqs_queue" "lambda_dlq" {
  name = "my-lambda-dlq"
}

# Update Lambda to use DLQ
resource "aws_lambda_function" "snowflake_to_s3" {
  function_name = "my-lambda-func"
  role          = aws_iam_role.lambda_exec.arn
  handler       = "app.handler"
  runtime       = "python3.11"
  filename      = "lambda.zip"

  dead_letter_config {
    target_arn = aws_sqs_queue.lambda_dlq.arn
  }
}

# CloudWatch alarm on DLQ ApproximateNumberOfMessagesVisible > 0
resource "aws_cloudwatch_metric_alarm" "dlq_messages_alarm" {
  alarm_name          = "lambda-my-lambda-func-dlq-messages"
  comparison_operator = "GreaterThanThreshold"
  evaluation_periods  = 1
  metric_name         = "ApproximateNumberOfMessagesVisible"
  namespace           = "AWS/SQS"
  period              = 60
  statistic           = "Sum"
  threshold           = 0

  dimensions = {
    QueueName = aws_sqs_queue.lambda_dlq.name
  }

  alarm_description = "Alarm when DLQ has any messages for my-lambda-func"
  alarm_actions     = [aws_sns_topic.alerts.arn]
}
```

If you tell me your exact Lambda name and region, I can tighten this into copy‑paste‑ready code for your setup.
